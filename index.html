<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Minesweeper</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#ececec;
    display:flex;
    flex-direction:column;
    align-items:center;
    margin:0;
    padding:0;
}

h1{ margin-top:10px; }

#controls{
    display:flex;
    gap:15px;
    margin:10px 0;
    flex-wrap:wrap;
    justify-content:center;
}

#board{
    display:grid;
    margin-top:10px;
    transition:transform 0.15s ease;
}

.cell{
    width:32px;
    height:32px;
    border:1px solid #999;
    background:#d0d0d0;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:bold;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    transition:background 0.15s, transform 0.1s;
}

.cell:hover{
    background:#c2c2c2;
}

.revealed{
    background:#e5e5e5 !important;
    cursor:default;
}

.mine{
    background:#ff6060 !important;
}

.flag{
    background:#ffd966;
}

#result{
    margin-top:20px;
    font-size:24px;
    font-weight:bold;
    height:30px;
}

/* –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω */
@media (max-width:600px){
    .cell{
        width:26px;
        height:26px;
        font-size:16px;
    }
}
@media (max-width:450px){
    .cell{
        width:22px;
        height:22px;
        font-size:14px;
    }
}
/* —Ç—Ä—è—Å–∫–∞ */
.shake{
    animation:shake 0.3s ease;
}

@keyframes shake{
    0%{ transform:translate(0,0); }
    25%{ transform:translate(-6px,4px); }
    50%{ transform:translate(6px,-4px); }
    75%{ transform:translate(-6px,-4px); }
    100%{ transform:translate(0,0); }
}

/* —á–∞—Å—Ç–∏—Ü—ã */
.particle{
    position:fixed;
    width:8px;
    height:8px;
    background:#ff3b3b;
    pointer-events:none;
    border-radius:2px;
    animation:fly 0.5s forwards ease-out;
}

@keyframes fly{
    from{ transform:translate(0,0) scale(1); opacity:1; }
    to{ transform:translate(var(--tx), var(--ty)) scale(0.2); opacity:0; }
}
</style>
</head>

<body>

<h1>Minesweeper</h1>

<div id="controls">
    <button onclick="setDifficulty('easy')">–õ–µ–≥–∫–æ</button>
    <button onclick="setDifficulty('medium')">–°—Ä–µ–¥–Ω–µ</button>
    <button onclick="setDifficulty('hard')">–°–ª–æ–∂–Ω–æ</button>
    <button onclick="newGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
</div>

<div id="board"></div>

<div id="result"></div>

<script>
let rows, cols, mines;
let board = [];
let gameOver = false;
let currentDifficulty = "easy";

function setDifficulty(d){
    currentDifficulty = d;
    newGame();
}

function newGame(){
    gameOver = false;
    document.getElementById("result").textContent = "";

    if(currentDifficulty === "easy"){
        rows = cols = 9;
        mines = 10;
    }else if(currentDifficulty === "medium"){
        rows = cols = 14;
        mines = 25;
    }else{
        rows = cols = 18;
        mines = 45;
    }

    const boardDiv = document.getElementById("board");

    // –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–ª–µ—Ç–æ–∫ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    if(currentDifficulty === "easy"){
        boardDiv.style.setProperty("--size","32px");
    }else if(currentDifficulty === "medium"){
        boardDiv.style.setProperty("--size","26px");
    }else{
        boardDiv.style.setProperty("--size","22px");
    }

    boardDiv.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    boardDiv.innerHTML = "";
    board = [];

    // —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª–µ
    for (let r = 0; r < rows; r++){
        board[r] = [];
        for (let c = 0; c < cols; c++){
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.r = r;
            cell.dataset.c = c;

            cell.addEventListener("click", leftClick);
            cell.addEventListener("contextmenu", rightClick);

            boardDiv.appendChild(cell);
            board[r][c] = { mine:false, revealed:false, flagged:false, el:cell };
        }
    }

    // —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω—ã
    let placed = 0;
    while(placed < mines){
        let r = Math.floor(Math.random()*rows);
        let c = Math.floor(Math.random()*cols);
        if(!board[r][c].mine){
            board[r][c].mine = true;
            placed++;
        }
    }
}

function leftClick(e){
    if(gameOver) return;
    const r = +e.target.dataset.r;
    const c = +e.target.dataset.c;

    reveal(r,c);
}

function rightClick(e){
    e.preventDefault();
    if(gameOver) return;

    const r = +e.target.dataset.r;
    const c = +e.target.dataset.c;

    const cell = board[r][c];

    if(cell.revealed) return;

    cell.flagged = !cell.flagged;
    cell.el.textContent = cell.flagged ? "üö©" : "";
}

function reveal(r,c){
    const cell = board[r][c];
    if(cell.revealed || cell.flagged) return;

    cell.revealed = true;
    cell.el.classList.add("revealed");

    if(cell.mine){
        explode(r,c);
        gameOver = true;
        document.getElementById("result").textContent = "‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ";
        return;
    }

    const n = countMines(r,c);
    if(n > 0){
        cell.el.textContent = n;
        cell.el.style.color = "black";
    }else{
        // —Ä–∞—Å–∫—Ä—ã—Ç—å —Å–æ—Å–µ–¥–µ–π
        for(let dr=-1; dr<=1; dr++){
            for(let dc=-1; dc<=1; dc++){
                let rr=r+dr, cc=c+dc;
                if(rr>=0 && rr<rows && cc>=0 && cc<cols){
                    if(!board[rr][cc].revealed) reveal(rr,cc);
                }
            }
        }
    }

    checkWin();
}

function countMines(r,c){
    let count=0;
    for(let dr=-1; dr<=1; dr++){
        for(let dc=-1; dc<=1; dc++){
            let rr=r+dr, cc=c+dc;
            if(rr>=0 && rr<rows && cc>=0 && cc<cols){
                if(board[rr][cc].mine) count++;
            }
        }
    }
    return count;
}

function explode(r,c){
    const cell = board[r][c].el;

    // –æ–¥–Ω–∞ –±–æ–º–±–∞
    cell.textContent = "üí£";

    const rect = cell.getBoundingClientRect();

    // —Ç—Ä—è—Å–∫–∞ –ø–æ–ª—è
    const boardDiv = document.getElementById("board");
    boardDiv.classList.add("shake");
    setTimeout(()=>boardDiv.classList.remove("shake"),300);

    // –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å—Ç–∏—Ü
    let particleCount = currentDifficulty === "easy" ? 40 :
                        currentDifficulty === "medium" ? 70 : 100;

    for(let i=0;i<particleCount;i++){

        // –ø—Ä–æ–ø—É—Å–∫ —á–∞—Å—Ç–∏—Ü –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö
        if(currentDifficulty !== "easy" && Math.random() < 0.25) continue;

        const p = document.createElement("div");
        p.className = "particle";

        p.style.left = (rect.left + 15) + "px";
        p.style.top = (rect.top + 15) + "px";

        // —Å–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–ª–µ—Ç
        p.style.setProperty("--tx", (Math.random()*300 - 150) + "px");
        p.style.setProperty("--ty", (Math.random()*300 - 150) + "px");

        document.body.appendChild(p);

        setTimeout(()=>p.remove(),500);
    }
}

function checkWin(){
    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            if(!board[r][c].mine && !board[r][c].revealed){
                return;
            }
        }
    }
    gameOver = true;
    document.getElementById("result").textContent = "üéâ –ü–æ–±–µ–¥–∞!";
}

newGame();
</script>

</body>
</html>
