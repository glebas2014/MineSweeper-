<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minesweeper ‚Äî –ú–∞–≥–º–∞ –ù–µ–æ–Ω</title>
<style>
:root{
  --bg1:#070306;
  --bg2:#13040a;
  --accent1:#ff8b1a;
  --accent2:#ff3b00;
  --accent3:#ffd07a;
  --cell-size:36px;
  --min-cell:14px;
}

*{box-sizing:border-box;}
html,body{margin:0;padding:12px;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Inter,sans-serif;color:#fff;}
body{display:flex;flex-direction:column;align-items:center;gap:12px;}

.top{width:100%;max-width:1100px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
h1{margin:0;font-size:1.2rem;text-shadow:0 4px 10px rgba(255,80,10,0.2);}
.controls{display:flex;gap:8px;align-items:center;}
button{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));color:#fff;border:0;padding:6px 10px;border-radius:8px;font-weight:700;cursor:pointer;}
button:active{transform:scale(.98);}
.diffs button{padding:4px 8px;border-radius:6px;background:transparent;}
.diffs button.selected{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#120202;}

.hud{display:flex;gap:12px;align-items:center;background:rgba(0,0,0,0.25);padding:6px 10px;border-radius:8px;}
.stat{font-weight:700;color:var(--accent3);}
.stat .value{margin-left:4px;color:#fff;text-shadow:0 4px 12px rgba(255,90,20,0.08);}

.board-wrap{background:linear-gradient(180deg, rgba(10,3,2,0.2), rgba(0,0,0,0.45));padding:10px;border-radius:10px;display:flex;justify-content:center;overflow:hidden;position:relative;}
#board{display:grid;gap:4px;}

.cell{
  width:var(--cell-size); height:var(--cell-size);
  background:linear-gradient(180deg,#0d0606,#170707);
  border-radius:4px;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;user-select:none;cursor:pointer;
  color:#000; transition:0.1s;
}
.cell.revealed{background:linear-gradient(180deg,#ffe8c8,#ffd9b0);}
.cell:hover{transform:translateY(-2px);}
.cell.flagged::before{content:"üö©";}
.cell.mine.revealed::before{content:"üí£";}

.num{color:#000;font-weight:900;font-size:calc(var(--cell-size)*0.5);text-shadow:0 4px 12px rgba(255,80,20,0.5);}

.particle{
  position:fixed;pointer-events:none;width:6px;height:6px;background:#ff8b1a;z-index:9999;
}

.shake{animation:shakeBig .72s cubic-bezier(.36,.07,.19,.97);}
@keyframes shakeBig{
  0%{transform:translate(0,0);}10%{transform:translate(-10px,6px) rotate(-0.5deg);}20%{transform:translate(10px,-8px) rotate(0.6deg);}
  30%{transform:translate(-12px,-6px) rotate(-0.9deg);}40%{transform:translate(12px,6px) rotate(0.8deg);}
  50%{transform:translate(-6px,6px) rotate(-0.4deg);}60%{transform:translate(6px,-6px) rotate(0.4deg);}
  70%{transform:translate(-4px,4px) rotate(-0.2deg);}100%{transform:translate(0,0) rotate(0);}
}

#resultBar{
  position:fixed; left:50%; transform:translateX(-50%) translateY(120%);
  bottom:18px; padding:12px 18px; border-radius:12px;
  background:linear-gradient(90deg,#6b0f00,#2b0500); color:#ffd7a8; font-weight:900;
  box-shadow:0 18px 50px rgba(0,0,0,0.6); opacity:0; transition:transform .35s,opacity .25s; z-index:120;
}
#resultBar.show{transform:translateX(-50%) translateY(0);opacity:1;}

@media(max-width:720px){:root{--cell-size:28px;}}
@media(max-width:420px){:root{--cell-size:22px;}}
</style>
</head>
<body>
<div class="top">
<h1>üî• Minesweeper ‚Äî –ú–∞–≥–º–∞ –ù–µ–æ–Ω</h1>
<div style="display:flex;gap:12px;align-items:center">
  <div class="controls">
    <div class="diffs" id="diffs">
      <button data-diff="easy" class="selected">–õ–µ–≥–∫–æ</button>
      <button data-diff="medium">–°—Ä–µ–¥–Ω–µ</button>
      <button data-diff="hard">–°–ª–æ–∂–Ω–æ</button>
    </div>
    <button id="newBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  </div>
  <div class="hud">
    <div class="stat">üí£<span id="minesLeft" class="value">0</span></div>
    <div class="stat">üö©<span id="flagsCount" class="value">0</span></div>
    <div class="stat">‚è±<span id="timer" class="value">0</span>s</div>
  </div>
</div>
</div>

<div class="board-wrap" id="boardWrap">
  <div id="board"></div>
</div>

<div id="resultBar"></div>

<script>
const DIFF = {
  easy:{rows:9,cols:9,mines:10,cellPx:36},
  medium:{rows:14,cols:14,mines:30,cellPx:28},
  hard:{rows:16,cols:24,mines:70,cellPx:20}
};
let current='easy',rows=DIFF[current].rows,cols=DIFF[current].cols,minesTotal=DIFF[current].mines;
let board=[],firstClick=true,gameState='playing',flagsCount=0,minesLeft=minesTotal,timer=0,timerId=null;

const boardEl=document.getElementById('board');
const boardWrap=document.getElementById('boardWrap');
const minesLeftEl=document.getElementById('minesLeft');
const flagsCountEl=document.getElementById('flagsCount');
const timerEl=document.getElementById('timer');
const resultBar=document.getElementById('resultBar');

function updateHUD(){minesLeftEl.textContent=minesLeft;flagsCountEl.textContent=flagsCount;timerEl.textContent=timer;}
function startTimer(){if(timerId)return;timer=0;timerEl.textContent=timer;timerId=setInterval(()=>{timer++;timerEl.textContent=timer;},1000);}
function stopTimer(){if(timerId){clearInterval(timerId);timerId=null;}}

function initGame(){
  stopTimer();firstClick=true;gameState='playing';flagsCount=0;minesLeft=DIFF[current].mines;timer=0;updateHUD();
  resultBar.classList.remove('show'); resultBar.textContent='';
  board=[]; boardEl.innerHTML=''; 
  boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
  boardEl.style.gridTemplateRows = `repeat(${rows}, var(--cell-size))`;

  for(let r=0;r<rows;r++){
    const row=[];
    for(let c=0;c<cols;c++){
      const el=document.createElement('div'); el.className='cell';
      el.dataset.r=r; el.dataset.c=c;
      el.addEventListener('click',()=>clickCell(r,c));
      el.addEventListener('contextmenu',e=>{e.preventDefault();toggleFlag(r,c);});
      boardEl.appendChild(el);
      row.push({mine:false,rev:false,flag:false,adj:0,el});
    }
    board.push(row);
  }
}

function placeMines(fr,fc){
  let p=0;
  while(p<minesTotal){
    const r=Math.floor(Math.random()*rows),c=Math.floor(Math.random()*cols);
    if(Math.abs(r-fr)<=1 && Math.abs(c-fc)<=1) continue;
    if(board[r][c].mine) continue;
    board[r][c].mine=true;p++;
  }
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    if(board[r][c].mine) continue; let cnt=0;
    for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
      const nr=r+dr,nc=c+dc; if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&board[nr][nc].mine) cnt++;
    }
    board[r][c].adj=cnt;
  }
}

function clickCell(r,c){
  if(gameState!=='playing') return; const o=board[r][c];
  if(o.rev||o.flag) return;
  if(firstClick){firstClick=false; placeMines(r,c); startTimer();}
  if(o.mine){triggerExplosion(r,c); revealAllMines(); lose(); return;}
  floodReveal(r,c); checkWin();
}

function floodReveal(r,c){
  const o=board[r][c]; if(o.rev||o.flag) return;
  o.rev=true; o.el.classList.add('revealed');
  if(o.adj>0){o.el.innerHTML=`<span class="num">${o.adj}</span>`; return;}
  for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){
    const nr=r+dr,nc=c+dc;if(nr>=0&&nr<rows&&nc>=0&&nc<cols) floodReveal(nr,nc);
  }
}

function toggleFlag(r,c){
  if(gameState!=='playing') return;
  const o=board[r][c]; if(o.rev) return;
  o.flag=!o.flag;
  if(o.flag){flagsCount++; o.el.classList.add('flagged'); o.el.textContent='üö©';} 
  else{flagsCount=Math.max(0,flagsCount-1); o.el.classList.remove('flagged'); o.el.textContent='';}
  minesLeft=Math.max(0,minesTotal-flagsCount); updateHUD(); checkWin();
}

function revealAllMines(){
  for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){
    const o=board[r][c];
    if(o.mine){o.rev=true;o.el.classList.add('revealed','mine');o.el.textContent='üí£';}
    else if(o.flag&&!o.mine){o.el.classList.add('revealed'); o.el.textContent='‚úñ';}
  }
}

function checkWin(){for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){if(!board[r][c].mine&&!board[r][c].rev) return;} win();}
function win(){gameState='win';stopTimer();showResult(`üéâ –ü–û–ë–ï–î–ê! ${timer}s`);}
function lose(){gameState='lose';stopTimer();showResult('üí• –ü–û–†–ê–ñ–ï–ù–ò–ï');}

function showResult(text){resultBar.textContent=text;resultBar.classList.add('show');setTimeout(()=>resultBar.classList.remove('show'),5000);}

/* explosion: strong shake + particles */
function triggerExplosion(r,c){
  const o=board[r][c]; o.el.classList.add('revealed','mine'); o.el.textContent='üí£';
  boardWrap.classList.add('shake'); setTimeout(()=>boardWrap.classList.remove('shake'),720);

  const rect=o.el.getBoundingClientRect(), cx=rect.left+rect.width/2, cy=rect.top+rect.height/2;
  const density = current==='easy'?40:current==='medium'?70:110;

  for(let i=0;i<density;i++){
    if(current!=='easy' && Math.random()<0.45) continue;
    const p=document.createElement('div'); p.className='particle';
    const colors=['#ff8b1a','#ff3b00','#ffcf6b','#ff6b00','#b32a00'];
    p.style.background=colors[Math.floor(Math.random()*colors.length)];
    const size=(Math.random()*6+4)*(current==='hard'?0.85:current==='medium'?0.95:1); p.style.width=p.style.height=size+'px';
    const jitterX=Math.random()*12-6, jitterY=Math.random()*12-6;
    p.style.left=(cx+jitterX)+'px'; p.style.top=(cy+jitterY)+'px';
    document.body.appendChild(p);

    const angle=Math.random()*2*Math.PI;
    const baseDistance=current==='hard'?360:current==='medium'?260:160;
    const distance=(Math.random()*baseDistance)+(current==='hard'?40:20);
    const tx=Math.cos(angle)*distance+(Math.random()*40-20), ty=Math.sin(angle)*distance-(Math.random()*80+20);

    p.animate([{transform:'translate(0,0) scale(1)',opacity:1},{transform:`translate(${tx}px,${ty}px) scale(0.28)`,opacity:0}],
    {duration:600+Math.random()*800,easing:'cubic-bezier(.2,.9,.2,1)',fill:'forwards'});
    setTimeout(()=>{try{p.remove();}catch(e){}},1600+Math.random()*800);
  }
}

/* UI bindings */
document.getElementById('newBtn').addEventListener('click',()=>initGame());
document.querySelectorAll('#diffs button').forEach(b=>b.addEventListener('click',()=>setDifficulty(b.dataset.diff)));
function setDifficulty(diff){current=diff;document.querySelectorAll('#diffs button').forEach(b=>b.classList.toggle('selected',b.dataset.diff===diff));initGame();}
initGame();
</script>
</body>
</html>
