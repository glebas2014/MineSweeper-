<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minesweeper</title>

<style>
body{
    font-family: Arial, sans-serif;
    background: #667eea;
    margin:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
    color:white;
}

h1 { margin-bottom: 10px; }

#controls{
    display:flex;
    gap:10px;
    margin-bottom:15px;
}

button{
    padding:8px 14px;
    border:none;
    background:#0003;
    color:white;
    border-radius:6px;
    font-size:15px;
    cursor:pointer;
}
button:hover{ background:#0005; }

#difficulty{
    margin-bottom:15px;
    display:flex;
    gap:10px;
}

.selected{
    background:#ffffff40;
}

#board{
    display:grid;
    gap:2px;
    padding:4px;
    background:#333;
    border-radius:6px;
    transform:scale(0.8);
    transform-origin:top center;
}

.cell{
    width:30px;
    height:30px;
    background:#bbb;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:4px;
    font-weight:bold;
    cursor:pointer;
}
.cell.revealed{ background:#eee; }
.cell.mine{ background:#e55; }
</style>
</head>

<body>

<h1>Minesweeper</h1>

<div id="controls">
    <button onclick="newGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <button onclick="showRules()">–ü—Ä–∞–≤–∏–ª–∞</button>
</div>

<div id="difficulty">
    <button class="selected" onclick="setDifficulty('easy', this)">–õ–µ–≥–∫–æ</button>
    <button onclick="setDifficulty('medium', this)">–°—Ä–µ–¥–Ω–µ</button>
    <button onclick="setDifficulty('hard', this)">–°–ª–æ–∂–Ω–æ</button>
</div>

<div id="board"></div>

<script>
let rows=9, cols=9, mines=10;
let board=[];
let firstClick=true;

function setDifficulty(level, btn){
    document.querySelectorAll("#difficulty button").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");

    if(level==="easy"){ rows=9; cols=9; mines=10; }
    if(level==="medium"){ rows=16; cols=16; mines=40; }
    if(level==="hard"){ rows=16; cols=30; mines=99; }

    newGame();
}

function newGame(){
    firstClick = true;
    const boardEl = document.getElementById("board");
    boardEl.innerHTML = "";
    boardEl.style.gridTemplateColumns = `repeat(${cols}, 30px)`;

    board = [];

    for(let r=0;r<rows;r++){
        board[r] = [];
        for(let c=0;c<cols;c++){
            const div = document.createElement("div");
            div.className = "cell";
            div.dataset.r = r;
            div.dataset.c = c;

            div.onclick = () => clickCell(r,c);
            div.oncontextmenu = (e)=>{ e.preventDefault(); toggleFlag(r,c); };

            boardEl.appendChild(div);
            board[r][c] = { mine:false, rev:false, flag:false, adj:0, el:div };
        }
    }
}

function placeMines(fr,fc){
    let placed = 0;
    while(placed < mines){
        const r = Math.floor(Math.random()*rows);
        const c = Math.floor(Math.random()*cols);

        if(Math.abs(r-fr)<=1 && Math.abs(c-fc)<=1) continue;
        if(board[r][c].mine) continue;

        board[r][c].mine = true;
        placed++;
    }

    // –ø–æ–¥—Å—á—ë—Ç —á–∏—Å–µ–ª
    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            if(board[r][c].mine) continue;
            let count = 0;
            for(let i=-1;i<=1;i++){
                for(let j=-1;j<=1;j++){
                    const nr=r+i, nc=c+j;
                    if(nr>=0&&nr<rows&&nc>=0&&nc<cols && board[nr][nc].mine) count++;
                }
            }
            board[r][c].adj = count;
        }
    }
}

function clickCell(r,c){
    const cell = board[r][c];
    if(cell.rev || cell.flag) return;

    if(firstClick){
        firstClick=false;
        placeMines(r,c);
    }

    if(cell.mine){
        lose();
        return;
    }

    reveal(r,c);
}

function reveal(r,c){
    const cell = board[r][c];
    if(cell.rev || cell.flag) return;
    cell.rev = true;
    cell.el.classList.add("revealed");

    if(cell.adj > 0){
        cell.el.textContent = cell.adj;
        return;
    }

    for(let i=-1;i<=1;i++){
        for(let j=-1;j<=1;j++){
            const nr=r+i, nc=c+j;
            if(nr>=0 && nr<rows && nc>=0 && nc<cols){
                reveal(nr,nc);
            }
        }
    }
}

function toggleFlag(r,c){
    const cell = board[r][c];
    if(cell.rev) return;
    cell.flag = !cell.flag;
    cell.el.textContent = cell.flag ? "üö©" : "";
}

function lose(){
    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            if(board[r][c].mine){
                board[r][c].el.classList.add("mine","revealed");
                board[r][c].el.textContent = "üí£";
            }
        }
    }
    alert("–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!");
}

function showRules(){
    alert(
        "–ü—Ä–∞–≤–∏–ª–∞ Minesweeper:\n\n" +
        "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–ª–µ—Ç–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –µ—ë.\n" +
        "‚Ä¢ –ß–∏—Å–ª–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –º–∏–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º.\n" +
        "‚Ä¢ –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∏–ª–∏ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–ª–∞–≥.\n" +
        "‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –≤—Å–µ –Ω–µ-–º–∏–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞—Ç—å.\n"
    );
}

newGame();
</script>
</body>
</html>
