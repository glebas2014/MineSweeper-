<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minesweeper FX</title>
<style>
:root{
  --bg1:#667eea;
  --bg2:#764ba2;
  --panel: rgba(255,255,255,0.08);
  --accent: #ffffff40;
  --cell-size:36px;
}
*{box-sizing:border-box}
body{
    font-family: Inter, Arial, sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    margin:0;display:flex;flex-direction:column;align-items:center;padding:18px;color:#fff;min-height:100vh;
}
.container{width:100%;max-width:720px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{font-size:1.25rem;margin:0}
.controls{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
button{padding:8px 12px;border-radius:8px;border:none;background:var(--panel);color:inherit;cursor:pointer;font-weight:600;transition:transform .12s ease,background .12s}
button:active{transform:scale(.98)}
#difficulty{display:flex;gap:8px}
.diff-btn{padding:6px 10px;border-radius:8px;background:transparent}
.diff-btn.selected{background:var(--accent)}
.toolbar{display:flex;gap:12px;align-items:center}
.stats{display:flex;gap:12px;align-items:center;background:var(--panel);padding:8px;border-radius:10px}
.stat{font-size:0.9rem}
.stat .value{font-weight:700;font-size:1.05rem}

.board-wrap{margin-top:12px;background:var(--panel);padding:10px;border-radius:12px;display:flex;justify-content:center;overflow:hidden}
#board{display:grid;gap:4px;padding:4px;border-radius:8px;background:#2f2f2f;touch-action:none;transition:transform .15s ease}

.cell{
  width:var(--cell-size);
  height:var(--cell-size);
  background:#cfcfcf;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  user-select:none;
  cursor:pointer;
  box-shadow:0 2px 0 rgba(0,0,0,0.15);
  transition:transform .12s,background .12s,color .12s,box-shadow .12s;
  font-size:calc(var(--cell-size)/2);
  color:#000;
}
.cell:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.28)}
.cell.revealed{background:#f3f3f3;transform:none;box-shadow:none}
.cell.flagged{background:#fff;color:#000}
.cell.flagged::before{content:"üö©";font-size:1.2rem}
.cell.mine.revealed::before{content:"üí£";font-size:1.2rem}
.number-1,.number-2,.number-3,.number-4,.number-5,.number-6,.number-7,.number-8{color:#000}

.cell.revealed{animation:pop .12s ease}
@keyframes pop{from{transform:scale(.96);opacity:.9}to{transform:none;opacity:1}}

.explosion{
    position:absolute;pointer-events:none;width:6px;height:6px;animation:burst .5s ease-out forwards;
}
@keyframes burst{
  0%{transform:translate(0,0) scale(1);opacity:1}
  100%{transform:translate(var(--tx),var(--ty)) scale(0.2);opacity:0}
}

#resultText{margin-top:14px;font-size:1.4rem;font-weight:700;text-shadow:0 2px 4px #00000070;height:32px;text-align:center}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üéØ Minesweeper FX</h1>
    <div class="toolbar">
      <div class="stats">
        <div class="stat">–ú–∏–Ω—ã: <span id="mines-remaining" class="value">10</span></div>
        <div class="stat">–§–ª–∞–≥–∏: <span id="flags-count" class="value">0</span></div>
        <div class="stat">–í—Ä–µ–º—è: <span id="timer" class="value">0</span>s</div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button id="newBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <div id="difficulty" style="margin-left:auto">
      <button class="diff-btn selected" data-diff="easy">–õ–µ–≥–∫–æ</button>
      <button class="diff-btn" data-diff="medium">–°—Ä–µ–¥–Ω–µ</button>
      <button class="diff-btn" data-diff="hard">–°–ª–æ–∂–Ω–æ</button>
    </div>
    <div id="explosionPanel" style="display:flex; gap:8px; margin-left:12px; flex-wrap:wrap;">
        <select id="explosionType">
            <option value="smoke">–î—ã–º</option>
            <option value="shards">–û—Å–∫–æ–ª–∫–∏</option>
        </select>
        <select id="particleShape">
            <option value="circle">–ö—Ä—É–≥–ª—ã–µ</option>
            <option value="square">–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ</option>
        </select>
    </div>
  </div>

  <div class="board-wrap"><div id="board"></div></div>
  <div id="resultText"></div>
</div>

<script>
const difficulties={
  easy:{rows:9,cols:9,mines:10,cellSize:36},
  medium:{rows:16,cols:16,mines:40,cellSize:24},
  hard:{rows:16,cols:30,mines:99,cellSize:18}
};
let current='easy',rows,cols,mines,board,first,timer,flags,gameState,timerId;

const boardEl=document.getElementById('board');
const minesRemEl=document.getElementById('mines-remaining');
const flagsEl=document.getElementById('flags-count');
const timerEl=document.getElementById('timer');
const resultText=document.getElementById('resultText');

function updateStats(){minesRemEl.textContent=mines-flags;flagsEl.textContent=flags;timerEl.textContent=timer;}
function resetDims(){rows=difficulties[current].rows;cols=difficulties[current].cols;mines=difficulties[current].mines;document.documentElement.style.setProperty('--cell-size',difficulties[current].cellSize+'px');}
function setDifficulty(d){ current=d; resetDims(); document.querySelectorAll('.diff-btn').forEach(b=>b.classList.toggle('selected', b.dataset.diff===d)); newGame(); }

document.getElementById('difficulty').addEventListener('click',e=>{if(e.target.classList.contains('diff-btn'))setDifficulty(e.target.dataset.diff);});
document.getElementById('newBtn').addEventListener('click',newGame);

function startTimer(){stopTimer();timer=0;timerId=setInterval(()=>{timer++;updateStats();},1000);}
function stopTimer(){if(timerId){clearInterval(timerId);timerId=null;}}

function newGame(){
    resetDims();stopTimer();first=true;gameState='playing';flags=0;timer=0;updateStats();resultText.textContent='';boardEl.innerHTML='';boardEl.style.gridTemplateColumns=`repeat(${cols},1fr)`;board=[];
    for(let r=0;r<rows;r++){board[r]=[];for(let c=0;c<cols;c++){const cell=document.createElement('div');cell.className='cell';cell.dataset.r=r;cell.dataset.c=c;boardEl.appendChild(cell);
    board[r][c]={mine:false,rev:false,flag:false,adj:0,el:cell};
    cell.addEventListener('click',()=>clickCell(r,c));
    cell.addEventListener('contextmenu',ev=>{ev.preventDefault();toggleFlag(r,c);});
    let pressTimer=null;
    cell.addEventListener('touchstart',()=>{pressTimer=setTimeout(()=>toggleFlag(r,c),600);});
    cell.addEventListener('touchend',()=>clearTimeout(pressTimer));
    }}
}

function placeMines(fr,fc){let p=0;while(p<mines){let r=Math.floor(Math.random()*rows),c=Math.floor(Math.random()*cols);if(Math.abs(r-fr)<=1&&Math.abs(c-fc)<=1)continue;if(board[r][c].mine)continue;board[r][c].mine=true;p++;}
for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){if(board[r][c].mine)continue;let cnt=0;for(let i=-1;i<=1;i++)for(let j=-1;j<=1;j++){let nr=r+i,nc=c+j;if(nr>=0&&nr<rows&&nc>=0&&nc<cols&&board[nr][nc].mine)cnt++;}board[r][c].adj=cnt;}}

function clickCell(r,c){if(gameState!=='playing')return;const o=board[r][c];if(o.rev||o.flag)return;if(first){first=false;placeMines(r,c);startTimer();}
if(o.mine){explode(r,c);gameOver(false);return;}reveal(r,c);checkWin();}

function reveal(r,c){const o=board[r][c];if(o.rev||o.flag)return;o.rev=true;o.el.classList.add('revealed');if(o.adj>0){o.el.textContent=o.adj;o.el.classList.add('number-'+o.adj);return;}for(let i=-1;i<=1;i++)for(let j=-1;j<=1;j++){let nr=r+i,nc=c+j;if(nr>=0&&nr<rows&&nc>=0&&nc<cols)reveal(nr,nc);}}

function toggleFlag(r,c){if(gameState!=='playing')return;const o=board[r][c];if(o.rev)return;o.flag=!o.flag;if(o.flag){flags++;o.el.innerHTML="üö©";}else{flags--;o.el.innerHTML="";}updateStats();checkWin();}

function explode(r,c){
    const cell=board[r][c].el;
    const rect=cell.getBoundingClientRect();
    const type=document.getElementById("explosionType").value;
    const shape=document.getElementById("particleShape").value;

    let count = current==="easy"?32: current==="medium"?48: 64;

    for(let i=0;i<count;i++){
        if(current!=="easy" && Math.random()<0.4) continue; // –ø—Ä–æ–ø—É—Å–∫–∏
        const p=document.createElement("div");
        p.className="explosion";
        p.style.borderRadius=shape==="circle"?"50%":"0%";
        p.style.background=type==="smoke"?"rgba(200,200,200,.8)":"#d6d6d6";
        const x = rect.left+rect.width/2;
        const y = rect.top+rect.height/2;
        p.style.left=x+"px";
        p.style.top=y+"px";
        const tx=(Math.random()*200-100);
        const ty=(Math.random()*200-100);
        p.style.setProperty("--tx",tx+"px");
        p.style.setProperty("--ty",ty+"px");
        document.body.appendChild(p);
        setTimeout(()=>p.remove(),500);
    }
    cell.classList.add("revealed","mine");
}

function revealAll(){for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(board[r][c].mine)board[r][c].el.innerHTML='üí£';}
function checkWin(){let safe=0;for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)if(!board[r][c].mine&&!board[r][c].rev)safe++;if(safe===0)gameOver(true);}
function gameOver(win){gameState=win?'win':'lose';stopTimer();if(!win)revealAll();resultText.textContent=win?`üéâ –ü–æ–±–µ–¥–∞! –í—Ä–µ–º—è: ${timer}s`:`üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ`;}
newGame();
</script>
</body>
</html>
